#!/usr/bin/env python

import os, time, sys, subprocess
file_location = sys.argv[1]
if len(sys.argv) > 2:
    re = sys.argv[2]
else:
    re = 0
file = os.path.expanduser('~') + '/.timestat'
module  = file_location
os.chdir(file_location[:file_location.find('modules') + len('modules')])
print module
files = os.walk(file_location)
def getNames(files):
    filtered = [i for i in files if '.git' not in i[0]]
    names = []
    for dirs in filtered:
        names = names + [dirs[0] + '/' + d for d in dirs[2]]
    return names
#print getNames(files)
def getTimes():
    names = getNames(files)
    times = []
    for name in names:
        times.append( os.path.getmtime(name))
    return times
print getTimes()
#while True:
last_modified = os.path.getmtime(file_location)
f = open(file, 'w')
#f.write(last_modified)
r = open(file, 'r')
mod = r.readline()
if mod != time.ctime(os.path.getmtime(file_location)):
    if re == '-u':
        subprocess.check_output(['drush', 'dis', module, '-y'])
        subprocess.check_output(['drush', 'pmu', module, '-y'])
    subprocess.check_output(['drush', 'cc', 'all' ])
    if re == '-u':
        subprocess.check_output(['drush', 'en', module, '-y'])
    print '\n'
    print '\n'
time.sleep(0.5)
