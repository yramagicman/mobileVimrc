#!/usr/bin/env python
import sys
import os
import commands
from subprocess import call

def build(project, cwd, argv):
    path= '/'+project
    dcs= commands.getstatusoutput('drush dcs ' + project)
    print call(['drush', 'dcs', path])
    #print call(['drush', 'coder-format', path])
    if len(sys.argv) == 4 and dcs[0] == 0:
        if sys.argv[3] == '-format' or sys.argv[3] == '--format':
            print 'format'
            print call(['drush', 'coder-format', path])
            print call(['drush', 'dcs', path])
            dcs= commands.getstatusoutput('drush dcs ' + project)
            print call (['find' , './', '-name', '*.coder*', '-ls', '-delete'])
            dirs=[]
            memo = []
            for i in os.walk('./'+project):
                if '.git' not in i[0]:
                    dirs.append(i[0])
            for dir in dirs:
                for file in os.walk( dir ):
                    if '.git' not in file[0]:
                       for code in file[2]:
                           if code not in memo:
                               memo.append(code)
                               f = open(file[0] + '/' + code, 'w')
                               f.close()



    if dcs[0] == 0:
        print call(['tar', '-czvf', project+'.tar.gz', './'+project])
site_name = sys.argv[1]
project = sys.argv[2]
print site_name
root_sites_dir='/Users/jonathan/Sites/'
if project not in os.getcwd():
    os.chdir(root_sites_dir + site_name + '/sites/all/modules/' )
    cwd = os.getcwd()
    build(project, cwd, sys.argv)
else:
    print 'success'
    os.chdir(root_sites_dir + site_name + '/sites/all/modules/' )
    cwd = os.getcwd()
    build(project, cwd, sys.argv)

 #find ./ -name '*.coder.orig' -delete
 #drush coder-review $1
 #rm ./*.coder.orig
 #find ./ -name '*.coder.orig' -delete
 #cd includes
 #pwd
 #g s
 #git diff
 #tail history -n50
 #history | tail -n 15
 #history | tail -n 25
 #drush coder-format csv-swapped
